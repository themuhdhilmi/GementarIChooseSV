// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  //url = "mysql://root:password@127.0.0.1:3306/ichoosesv"
  url      = env("DATABASE_URL")
}

model Account {
  id                 String    @id @default(cuid())
  userId             String
  providerType       String
  providerId         String
  providerAccountId  String
  refreshToken       String?
  accessToken        String?
  accessTokenExpires DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  user               User      @relation(fields: [userId], references: [id])

  @@unique([providerId, providerAccountId])
}

model Session {
  id                 String               @id @default(cuid())
  userId             String
  expires            DateTime
  sessionToken       String               @unique
  accessToken        String               @unique
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  user               User                 @relation(fields: [userId], references: [id])
  StudentInformation StudentInformation[]
}

model User {
  id                       String               @id @default(cuid())
  name                     String?
  email                    String?              @unique
  emailVerified            DateTime?
  image                    String?
  hashedPassword           String?
  createdAt                DateTime             @default(now())
  updatedAt                DateTime             @updatedAt
  accounts                 Account[]
  sessions                 Session[]
  role                     Role                 @default(STUDENT)
  hasChangeOneTimePassword Boolean              @default(false)
  studentInformation       StudentInformation?
  LecturerInformation      LecturerInformation?
  StudentAnswer            StudentAnswer[]
}

enum Role {
  ADMIN
  LECTURER
  STUDENT
}

model VerificationRequest {
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, token])
}

enum Track {
  SOFTWARE
  NETWORK
  SECURITY
}

model SessionYear {
  id      String @id @default(cuid())
  number  Int
  yearOne Int
  yearTwo Int

  globalMemberQuota     Int @default(4)
  globalTitleQuota      Int @default(3)
  globalSupervisorQuota Int @default(3)

  finalPresentationDate DateTime @default(now())

  isSelected Boolean @default(false)

  StudentInformation StudentInformation[]
  Supervisor         LecturerInformation[]
}

// +======================= LECTURER START =======================
model LecturerInformation {
  id                 String               @id @default(cuid())
  StudentInformation StudentInformation[]

  supervisorQuota Int?

  Track       Track
  SessionYear SessionYear[]
  User        User          @relation(fields: [userId], references: [id])
  userId      String        @unique
}

// -======================= LECTURER END =========================

// +======================= STUDENT START ========================
model StudentInformation {
  id           String @id @default(cuid())
  matricNumber String @unique
  memberQuota  Int?
  titleQuota   Int?

  User                    User                       @relation(fields: [userId], references: [id])
  userId                  String                     @unique
  Member                  Member[]
  Session                 Session?                   @relation(fields: [sessionId], references: [id])
  sessionId               String?
  SessionYear             SessionYear                @relation(fields: [sessionYearId], references: [id])
  sessionYearId           String
  LecturerInformation     LecturerInformation?       @relation(fields: [lecturerInformationId], references: [id])
  lecturerInformationId   String?
  lecturerAcceptedStudent SupervisorAcceptanceStatus @default(NONE)
  ProjectTitle            ProjectTitle[]
  Track                   Track
  StudentScore            StudentScore?              @relation(fields: [studentScoreId], references: [id])
  studentScoreId          String?
}

enum SupervisorAcceptanceStatus {
  NONE
  REQUESTED
  ACCEPTED
  DECLINED
}

model Member {
  id           String @id @default(cuid())
  name         String
  matricNumber String @unique

  StudentInformation   StudentInformation? @relation(fields: [studentInformationId], references: [id])
  studentInformationId String?
}

model ProjectTitle {
  id                   String              @id @default(cuid())
  name                 String
  uploadedPoster       String?
  StudentInformation   StudentInformation? @relation(fields: [studentInformationId], references: [id])
  studentInformationId String?
}

// -======================= STUDENT END =======================

// +======================= QUESTION START ========================

enum QuestionType {
  MULTI_CHOICE
  ESSAY
  FILL_IN_THE_BLANKS
}

model Subject {
  id       String     @id @default(cuid())
  title    String
  isHidden Boolean    @default(false)
  Question Question[]
}

model Question {
  id              String          @id @default(cuid())
  title           String
  timeLimit       Int
  subject         Subject         @relation(fields: [subjectId], references: [id])
  childQuestion   ChildQuestion[]
  subjectId       String
  studentScore    StudentScore[]
  studentAnswerId String?
  StudentAnswer   StudentAnswer[]

  timeStart DateTime @default(now())
  timeEnd   DateTime @default(now())
}

model ChildQuestion {
  id              String              @id @default(cuid())
  label           String              @default("Empty Label")
  sortingPosition Int                 @default(1)
  questionBody    QuestionBody[]
  questionType    QuestionType        @default(MULTI_CHOICE)
  answerDummy     AnswerStringDummy[]
  StudentScore    StudentScore[]
  Question        Question?           @relation(fields: [questionId], references: [id])
  questionId      String?
  StudentAnswer   StudentAnswer?      @relation(fields: [studentAnswerId], references: [id])
  studentAnswerId String?
}

model QuestionBody {
  id              String         @id @default(cuid())
  string          String
  answer          AnswerString[]
  childQuestion   ChildQuestion? @relation(fields: [childQuestionId], references: [id])
  childQuestionId String?
}

model AnswerString {
  id           String         @id @default(cuid())
  stringBefore String?
  string       String
  stringAfter  String?
  point        Int            @default(1)
  QuestionBody QuestionBody[]
}

model AnswerStringDummy {
  id              String         @id @default(cuid())
  string          String
  childQuestion   ChildQuestion? @relation(fields: [childQuestionId], references: [id])
  childQuestionId String?
}

model StudentScore {
  id                 String               @id @default(cuid())
  dateStart          DateTime             @default(now())
  dateEnd            DateTime             @default(now())
  studentInformation StudentInformation[]
  scoredQuestion     ChildQuestion[]
  Question           Question?            @relation(fields: [questionId], references: [id])
  questionId         String?
}

model StudentAnswer {
  id           String          @id @default(cuid())
  question     Question        @relation(fields: [questionId], references: [id])
  totalScore   Int             @default(0)
  doneQuestion ChildQuestion[]
  questionId   String

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

// -======================= QUESTION START ========================
